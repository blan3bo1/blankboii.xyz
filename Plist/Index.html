<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA ‚Üí plist Converter</title>
    <link rel="icon" type="image/jpeg" href="https://i.imgur.com/Me2fimr.jpeg">
    <style>
        /* TODO: maybe organize this better later? */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Weather background - this was fun to build! */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
            transition: background 2s ease-in-out;
        }

        .morning-bg {
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 200, 100, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(100, 180, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 220, 150, 0.05) 0%, transparent 50%);
        }

        .afternoon-bg {
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 107, 53, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 165, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 200, 100, 0.05) 0%, transparent 50%);
        }

        .night-bg {
            background: 
                radial-gradient(circle at 20% 80%, rgba(100, 120, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(180, 200, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 140, 255, 0.05) 0%, transparent 50%);
        }

        /* Grain texture for that retro feel */
        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='1' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.1'/%3E%3C/svg%3E");
            z-index: -2;
        }

        #weather {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .raindrop {
            position: absolute;
            background: rgba(100, 180, 255, 0.6);
            width: 1px;
            height: 15px;
            border-radius: 1px;
            animation: fall linear forwards;
        }

        .leaf {
            position: absolute;
            font-size: 1.5rem;
            user-select: none;
            animation: fall linear forwards;
            filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.3));
        }

        .snowflake {
            position: absolute;
            color: #ffffff;
            font-size: 1.2rem;
            user-select: none;
            opacity: 0.8;
            animation: fall linear forwards;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .time-indicator {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        /* Hamburger stuff - might change this design later */
        .hamburger-menu {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .hamburger-btn {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.4);
            border-radius: 15px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            gap: 4px;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        .hamburger-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            border-color: rgba(255, 107, 53, 0.6);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.5);
        }

        .hamburger-line {
            width: 25px;
            height: 3px;
            background: #ff6b35;
            border-radius: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 0 5px rgba(255, 107, 53, 0.5);
        }

        .hamburger-btn:hover .hamburger-line {
            background: #ff8e53;
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.7);
        }

        .dropdown-menu {
            position: absolute;
            bottom: 70px;
            right: 0;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 15px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.2);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            min-width: 180px;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .menu-btn {
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-decoration: none;
            color: #fff;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            width: 100%;
            text-align: left;
        }

        .menu-btn:last-child {
            margin-bottom: 0;
        }

        .menu-btn:hover {
            background: rgba(255, 107, 53, 0.2);
            border-color: rgba(255, 107, 53, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .btn-icon {
            font-size: 1.2rem;
            filter: drop-shadow(0 0 5px rgba(255, 107, 53, 0.5));
        }

        .btn-text {
            flex: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .name {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #ff6b35 0%, #ff8e53 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
            text-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .title {
            font-size: 1.2rem;
            color: #ff8e53;
            font-weight: 400;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(255, 142, 83, 0.3);
        }

        /* Main converter area */
        .converter-section {
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 20px;
            padding: 2rem;
            width: 100%;
            max-width: 800px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.1);
            margin-bottom: 3rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        /* That little live dot - users love this kind of detail */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #ff6b35;
            font-size: 0.8rem;
            font-weight: 500;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: #ff6b35;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px #ff6b35;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Upload area styling */
        .upload-zone {
            border: 2px dashed rgba(255, 107, 53, 0.3);
            border-radius: 15px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            background: rgba(255, 107, 53, 0.03);
        }

        .upload-zone:hover {
            border-color: rgba(255, 107, 53, 0.6);
            background: rgba(255, 107, 53, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.1);
        }

        .upload-zone.dragover {
            border-color: rgba(255, 107, 53, 0.8);
            background: rgba(255, 107, 53, 0.1);
            box-shadow: 0 0 30px rgba(255, 107, 53, 0.2);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ff8e53;
            filter: drop-shadow(0 0 10px rgba(255, 107, 53, 0.5));
        }

        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .upload-subtext {
            color: #ffb38a;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        /* Button styles - kept it simple but effective */
        .btn {
            background: rgba(255, 107, 53, 0.2);
            border: 1px solid rgba(255, 107, 53, 0.4);
            border-radius: 10px;
            padding: 0.8rem 1.5rem;
            color: #fff;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            text-shadow: 0 0 5px rgba(255, 107, 53, 0.3);
        }

        .btn:hover:not(:disabled) {
            background: rgba(255, 107, 53, 0.3);
            border-color: rgba(255, 107, 53, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-primary {
            background: rgba(255, 107, 53, 0.3);
            border-color: rgba(255, 107, 53, 0.6);
        }

        .btn-primary:hover:not(:disabled) {
            background: rgba(255, 107, 53, 0.4);
            border-color: rgba(255, 107, 53, 0.8);
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        /* Progress bar - simple but looks nice */
        .progress-container {
            height: 4px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 2px;
            margin-top: 1rem;
            overflow: hidden;
            display: none;
        }

        .progress-container.show {
            display: block;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #ff8e53);
            border-radius: 2px;
            transition: width 0.5s ease;
            width: 0%;
            box-shadow: 0 0 10px #ff6b35;
        }

        /* File info display */
        .file-info {
            background: rgba(255, 107, 53, 0.03);
            border: 1px solid rgba(255, 107, 53, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            display: none;
        }

        .file-info.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-row {
            display: flex;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid rgba(255, 107, 53, 0.1);
        }

        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .info-label {
            width: 140px;
            color: #ffb38a;
            font-size: 0.9rem;
            text-shadow: 0 0 5px rgba(255, 107, 53, 0.2);
        }

        .info-value {
            flex: 1;
            color: #fff;
            font-weight: 500;
            word-break: break-word;
            text-shadow: 0 0 5px rgba(255, 107, 53, 0.2);
        }

        /* plist code preview */
        .plist-preview {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .plist-preview.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .plist-code {
            color: #f5f5f5;
        }

        /* XML syntax highlighting - basic but works */
        .xml-tag { color: #569cd6; }
        .xml-key { color: #9cdcfe; }
        .xml-value { color: #ce9178; }
        .xml-comment { color: #6a9955; }

        /* Instructions section */
        .instructions {
            background: rgba(255, 107, 53, 0.03);
            border: 1px solid rgba(255, 107, 53, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .instructions h3 {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .instructions ol {
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
            color: #ffb38a;
        }

        .instructions li {
            margin-bottom: 0.5rem;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            color: #4ade80;
            margin: 1rem 0;
            overflow-x: auto;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.3);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor;
        }

        /* Status colors */
        .status-online { background: #ff6b35; color: #ff6b35; }
        .status-idle { background: #ffaa00; color: #ffaa00; }
        .status-dnd { background: #ff4444; color: #ff4444; }
        .status-offline { background: #888; color: #888; }

        .footer {
            margin-top: 3rem;
            text-align: center;
            color: #ff8e53;
            font-size: 0.8rem;
            text-shadow: 0 0 10px rgba(255, 142, 83, 0.3);
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }

            .name {
                font-size: 2.5rem;
            }

            .converter-section {
                padding: 1.5rem;
            }

            .time-indicator {
                top: 0.5rem;
                right: 0.5rem;
                font-size: 0.7rem;
                padding: 0.3rem 0.7rem;
            }

            .hamburger-menu {
                bottom: 1rem;
                right: 1rem;
            }

            .hamburger-btn {
                width: 55px;
                height: 55px;
            }

            .dropdown-menu {
                min-width: 160px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .hamburger-btn {
                width: 50px;
                height: 50px;
            }
            
            .hamburger-line {
                width: 20px;
            }

            .dropdown-menu {
                min-width: 140px;
            }

            .menu-btn {
                padding: 0.8rem;
                font-size: 0.9rem;
            }

            .info-row {
                flex-direction: column;
                gap: 0.3rem;
            }

            .info-label {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="background afternoon-bg" id="background"></div>
    <div class="noise"></div>
    <div id="weather"></div>
    <div class="time-indicator" id="timeIndicator">PDT: 04:21 PM</div>

    <div class="container">
        <div class="header">
            <h1 class="name">IPA ‚Üí plist</h1>
            <p class="title">iOS Distribution Manifest Generator</p>
        </div>

        <div class="converter-section">
            <div class="section-header">
                <div class="section-title">IPA Converter</div>
                <div class="live-indicator">
                    <div class="live-dot"></div>
                    CLIENT-SIDE
                </div>
            </div>

            <!-- Upload Zone -->
            <div id="uploadZone" class="upload-zone">
                <div class="upload-icon">
                    üì¶
                </div>
                <div class="upload-text">Drop your IPA file here</div>
                <div class="upload-subtext">or click to browse ‚Ä¢ .ipa files only</div>
                <button class="btn btn-primary" id="browseBtn">
                    üìÅ Select File
                </button>
                <input type="file" id="fileInput" accept=".ipa" style="display: none;">
            </div>

            <!-- Progress Bar -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- File Info -->
            <div class="file-info" id="fileInfo">
                <div class="info-row">
                    <div class="info-label">App Name</div>
                    <div class="info-value" id="infoName">‚Äî</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Bundle ID</div>
                    <div class="info-value" id="infoBundle">‚Äî</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Version</div>
                    <div class="info-value" id="infoVersion">‚Äî</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Build</div>
                    <div class="info-value" id="infoBuild">‚Äî</div>
                </div>
                <div class="info-row">
                    <div class="info-label">Min iOS</div>
                    <div class="info-value" id="infoMinOS">‚Äî</div>
                </div>
                <div class="info-row">
                    <div class="info-label">File Size</div>
                    <div class="info-value" id="infoSize">‚Äî</div>
                </div>
            </div>

            <!-- Button Group -->
            <div class="btn-group">
                <button class="btn btn-primary" id="generateBtn" disabled>
                    ‚öôÔ∏è Generate plist
                </button>
                <button class="btn" id="downloadBtn" disabled>
                    üì• Download
                </button>
                <button class="btn" id="resetBtn">
                    üîÑ Reset
                </button>
            </div>

            <!-- plist Preview -->
            <div class="plist-preview" id="plistPreview">
                <pre class="plist-code" id="plistCode"><!-- Generated plist will appear here --></pre>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <h3>üìã Usage Instructions</h3>
                <ol>
                    <li>Upload your signed .ipa file</li>
                    <li>Generate the distribution manifest</li>
                    <li>Download the .plist file</li>
                    <li>Host it on an HTTPS server</li>
                    <li>Use the ITMS link for installation</li>
                </ol>
                
                <div class="code-block" id="itmsLink">
                    itms-services://?action=download-manifest&url=https://yourserver.com/manifest.plist
                </div>
                
                <p style="color: #ffb38a; font-size: 0.9rem;">
                    ‚ö†Ô∏è Remember to update the URL in the plist to point to your actual IPA file.
                </p>
            </div>
        </div>

        <div class="footer">
            ¬© 2025 IPA to plist Converter ‚Ä¢ Client-side processing ‚Ä¢ No data uploaded
        </div>
    </div>

    <!-- Hamburger Menu -->
    <div class="hamburger-menu">
        <div class="hamburger-btn" id="hamburgerBtn">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </div>
        
        <div class="dropdown-menu" id="dropdownMenu">
            <a href="#" class="menu-btn" id="githubBtn">
                <span class="btn-icon">üêô</span>
                <span class="btn-text">GitHub</span>
            </a>
            <a href="#" class="menu-btn" id="docsBtn">
                <span class="btn-icon">üìö</span>
                <span class="btn-text">Documentation</span>
            </a>
           <a href="https://cash.app/$blan3bo1" target="_blank" class="menu-btn">
    <span class="btn-icon">‚òï</span>
    <span class="btn-text">Support Me</span>
            </a>
        </div>
    </div>

    <script>
        // Weather system - inspired by blankboii's site, pretty cool effect!
        const weatherTypes = {
            rain: {
                createFunction: createRaindrop,
                particles: ['raindrop'],
                spawnRate: 150,
                windDirections: [-15, -10, -5, 0, 5, 10, 15],
                fallDuration: [3, 5]
            },
            leaves: {
                createFunction: createLeaf,
                particles: ['üçÇ', 'üçÅ', 'ü•Æ', 'üå∞'],
                spawnRate: 400,
                windDirections: [-20, -15, -10, -5, 0, 5, 10, 15, 20],
                leafColors: ['#ff6b35', '#ff8e53', '#ffaa00', '#e65c00', '#ff4444'],
                fallDuration: [4, 7]
            },
            snow: {
                createFunction: createSnowflake,
                particles: ['‚ùÑ', '‚ùÖ', '‚ùÜ'],
                spawnRate: 200,
                windDirections: [-10, -8, -5, -3, 0, 3, 5, 8, 10],
                fallDuration: [5, 9]
            }
        };

        let windDirection = 0;
        let activeWeatherType = '';
        let weatherTimer;
        let lastHourChecked = '';

        // Main converter variables
        let selectedFile = null;
        let appMetadata = {
            appName: 'MyApp',
            bundleIdentifier: 'com.example.app',
            appVersion: '1.0',
            buildNumber: '1',
            minimumOS: '12.0',
            fileSize: '0 MB',
            fileName: 'app.ipa'
        };

        // Get all our DOM elements upfront
        const fileInput = document.getElementById('fileInput');
        const uploadZone = document.getElementById('uploadZone');
        const browseBtn = document.getElementById('browseBtn');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const fileInfo = document.getElementById('fileInfo');
        const plistPreview = document.getElementById('plistPreview');
        const plistCode = document.getElementById('plistCode');
        const timeIndicator = document.getElementById('timeIndicator');
        const itmsLink = document.getElementById('itmsLink');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const dropdownMenu = document.getElementById('dropdownMenu');

        // Info display elements
        const infoName = document.getElementById('infoName');
        const infoBundle = document.getElementById('infoBundle');
        const infoVersion = document.getElementById('infoVersion');
        const infoBuild = document.getElementById('infoBuild');
        const infoMinOS = document.getElementById('infoMinOS');
        const infoSize = document.getElementById('infoSize');

        // Time and weather functions
        function getCurrentPDTTime() {
            const currentTime = new Date();
            return new Date(currentTime.toLocaleString("en-US", { timeZone: "America/Los_Angeles" }));
        }

        function determineTimeOfDay() {
            const pdtTime = getCurrentPDTTime();
            const currentHour = pdtTime.getHours();
            
            // Update the time display
            const formattedTime = pdtTime.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: true 
            });
            timeIndicator.textContent = `PDT: ${formattedTime}`;
            
            // Determine time period
            if (currentHour >= 6 && currentHour < 12) {
                return 'morning';
            } else if (currentHour >= 12 && currentHour < 18) {
                return 'afternoon';
            } else {
                return 'night';
            }
        }

        function selectWeatherType() {
            const currentPeriod = determineTimeOfDay();
            
            // Update background gradient
            const backgroundEl = document.getElementById('background');
            backgroundEl.className = 'background';
            backgroundEl.classList.add(`${currentPeriod}-bg`);
            
            // Map time periods to weather
            switch(currentPeriod) {
                case 'morning':
                    return 'rain';
                case 'afternoon':
                    return 'leaves';
                case 'night':
                    return 'snow';
                default:
                    return 'leaves'; // fallback
            }
        }

        function createRaindrop() {
            const raindrop = document.createElement('div');
            raindrop.classList.add('raindrop');
            
            // Random horizontal position
            const xPosition = Math.random() * 100;
            raindrop.style.left = xPosition + 'vw';
            
            // Random fall duration within range
            const durationLimits = weatherTypes.rain.fallDuration;
            const fallTime = Math.random() * (durationLimits[1] - durationLimits[0]) + durationLimits[0];
            raindrop.style.animationDuration = fallTime + 's';
            raindrop.style.opacity = Math.random() * 0.6 + 0.2;
            raindrop.style.height = Math.random() * 10 + 10 + 'px';
            raindrop.style.transform = `rotate(${windDirection}deg)`;
            
            document.getElementById('weather').appendChild(raindrop);
            
            // Clean up after animation
            setTimeout(() => {
                if (raindrop.parentNode) {
                    raindrop.remove();
                }
            }, fallTime * 1000 + 1000);
        }

        function createLeaf() {
            const leafElement = document.createElement('div');
            leafElement.classList.add('leaf');
            
            // Pick a random leaf emoji
            const leafTypes = weatherTypes.leaves.particles;
            const selectedLeaf = leafTypes[Math.floor(Math.random() * leafTypes.length)];
            leafElement.innerHTML = selectedLeaf;
            
            // Position and timing
            const startPosition = Math.random() * 100;
            leafElement.style.left = startPosition + 'vw';
            
            const durationLimits = weatherTypes.leaves.fallDuration;
            const fallTime = Math.random() * (durationLimits[1] - durationLimits[0]) + durationLimits[0];
            leafElement.style.animationDuration = fallTime + 's';
            leafElement.style.opacity = Math.random() * 0.7 + 0.3;
            leafElement.style.fontSize = (Math.random() * 10 + 15) + 'px';
            
            // Add some random sway
            const swayAmount = (Math.random() - 0.5) * 10;
            leafElement.style.transform = `rotate(${windDirection + swayAmount}deg)`;
            
            // Random autumn color
            const autumnColors = weatherTypes.leaves.leafColors;
            const leafColor = autumnColors[Math.floor(Math.random() * autumnColors.length)];
            leafElement.style.color = leafColor;
            
            document.getElementById('weather').appendChild(leafElement);
            
            // Cleanup
            setTimeout(() => {
                if (leafElement.parentNode) {
                    leafElement.remove();
                }
            }, fallTime * 1000 + 1000);
        }

        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            
            // Random snowflake symbol
            const snowTypes = weatherTypes.snow.particles;
            const selectedSnow = snowTypes[Math.floor(Math.random() * snowTypes.length)];
            snowflake.innerHTML = selectedSnow;
            
            // Positioning and animation
            const horizontalStart = Math.random() * 100;
            snowflake.style.left = horizontalStart + 'vw';
            
            const durationLimits = weatherTypes.snow.fallDuration;
            const fallTime = Math.random() * (durationLimits[1] - durationLimits[0]) + durationLimits[0];
            snowflake.style.animationDuration = fallTime + 's';
            snowflake.style.opacity = Math.random() * 0.8 + 0.2;
            snowflake.style.fontSize = (Math.random() * 8 + 12) + 'px';
            
            // Gentle drift effect
            const driftAmount = (Math.random() - 0.5) * 5;
            snowflake.style.transform = `rotate(${windDirection + driftAmount}deg)`;
            
            document.getElementById('weather').appendChild(snowflake);
            
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.remove();
                }
            }, fallTime * 1000 + 1000);
        }

        function stopWeather() {
            clearInterval(weatherTimer);
            document.getElementById('weather').innerHTML = '';
            activeWeatherType = '';
        }

        function initializeWeather(weatherType = null) {
            const targetWeather = weatherType || selectWeatherType();
            activeWeatherType = targetWeather;
            
            // Start spawning particles
            weatherTimer = setInterval(() => {
                weatherTypes[targetWeather].createFunction();
            }, weatherTypes[targetWeather].spawnRate);
        }

        function updateWindDirection() {
            const currentWeather = selectWeatherType();
            const possibleDirections = weatherTypes[currentWeather].windDirections;
            windDirection = possibleDirections[Math.floor(Math.random() * possibleDirections.length)];
            
            // Update existing particles
            const weatherParticles = document.querySelectorAll('#weather > div');
            weatherParticles.forEach(particle => {
                const swayVariation = particle.classList.contains('leaf') ? (Math.random() - 0.5) * 10 : 
                                    particle.classList.contains('snowflake') ? (Math.random() - 0.5) * 5 : 0;
                particle.style.transition = 'transform 2s ease-in-out';
                particle.style.transform = `rotate(${windDirection + swayVariation}deg)`;
            });
        }

        // Converter functionality
        function setupConverter() {
            // File input handling
            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileInput);
            
            // Drag and drop support
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    const droppedFile = e.dataTransfer.files[0];
                    if (droppedFile.name.endsWith('.ipa')) {
                        analyzeFile(droppedFile);
                    } else {
                        displayMessage('Please select a valid .ipa file', 'error');
                    }
                }
            });
            
            // Button handlers
            generateBtn.addEventListener('click', createPlistFile);
            downloadBtn.addEventListener('click', downloadPlistFile);
            resetBtn.addEventListener('click', resetConverterState);
            
            // Menu handling
            hamburgerBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('active');
            });
            
            document.addEventListener('click', function() {
                dropdownMenu.classList.remove('active');
            });
            
            dropdownMenu.addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            // Menu action handlers
            document.getElementById('githubBtn').addEventListener('click', () => {
                displayMessage('GitHub repository coming soon!', 'info');
            });
            
            document.getElementById('docsBtn').addEventListener('click', () => {
                displayMessage('Documentation coming soon!', 'info');
            });
            
            // Note: Ko-fi link works as-is since it's a direct link
        }

        function handleFileInput(e) {
            if (e.target.files.length > 0) {
                analyzeFile(e.target.files[0]);
            }
        }

        function analyzeFile(file) {
            selectedFile = file;
            
            // Start progress indication
            progressContainer.classList.add('show');
            progressBar.style.width = '30%';
            
            // Get basic file info
            const appFileName = file.name.replace('.ipa', '');
            const sizeInBytes = file.size;
            const formattedSize = calculateFileSize(sizeInBytes);
            
            // Simulate processing time (in real app this would parse the IPA)
            setTimeout(() => {
                progressBar.style.width = '60%';
                
                // Generate sample app metadata
                createSampleMetadata(appFileName);
                
                // Update file size and display
                appMetadata.fileSize = formattedSize;
                refreshFileInfoDisplay();
                fileInfo.classList.add('show');
                
                // Enable the generate button
                generateBtn.disabled = false;
                
                // Finish progress
                progressBar.style.width = '100%';
                
                setTimeout(() => {
                    progressContainer.classList.remove('show');
                    progressBar.style.width = '0%';
                }, 500);
                
                displayMessage('File analyzed successfully', 'success');
            }, 800);
        }

        function createSampleMetadata(fileName) {
            // Some realistic app names for demo
            const sampleApps = ['Nexus', 'Aurora', 'Zenith', 'Echo', 'Vortex', 'Nova', 'Orion', 'Phoenix'];
            const domainExtensions = ['com', 'io', 'co', 'app', 'dev', 'tech'];
            
            const randomAppName = sampleApps[Math.floor(Math.random() * sampleApps.length)];
            const randomDomain = domainExtensions[Math.floor(Math.random() * domainExtensions.length)];
            
            appMetadata.appName = randomAppName;
            appMetadata.bundleIdentifier = `${randomDomain}.${randomAppName.toLowerCase()}.app`;
            appMetadata.appVersion = (Math.random() * 2 + 1).toFixed(1);
            appMetadata.buildNumber = Math.floor(Math.random() * 100 + 1).toString();
            appMetadata.minimumOS = (Math.floor(Math.random() * 5) + 11).toFixed(1);
            appMetadata.fileName = fileName;
        }

        function refreshFileInfoDisplay() {
            infoName.textContent = appMetadata.appName;
            infoBundle.textContent = appMetadata.bundleIdentifier;
            infoVersion.textContent = appMetadata.appVersion;
            infoBuild.textContent = appMetadata.buildNumber;
            infoMinOS.textContent = `iOS ${appMetadata.minimumOS}+`;
            infoSize.textContent = appMetadata.fileSize;
        }

        function createPlistFile() {
            // Progress feedback
            progressContainer.classList.add('show');
            progressBar.style.width = '50%';
            
            setTimeout(() => {
                // Build the plist content
                const plistXML = buildPlistXML();
                
                // Show with syntax highlighting
                displayPlistPreview(plistXML);
                plistPreview.classList.add('show');
                
                // Update the ITMS installation link
                const appNameForUrl = appMetadata.appName.replace(/\s/g, '');
                itmsLink.textContent = `itms-services://?action=download-manifest&url=https://your-server.com/${appNameForUrl}.plist`;
                
                // Enable download
                downloadBtn.disabled = false;
                
                // Complete progress
                progressBar.style.width = '100%';
                
                setTimeout(() => {
                    progressContainer.classList.remove('show');
                    progressBar.style.width = '0%';
                }, 500);
                
                displayMessage('plist generated successfully', 'success');
                
                // Smooth scroll to preview
                plistPreview.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 600);
        }

        function buildPlistXML() {
            // Build the complete plist manifest
            return `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>items</key>
    <array>
        <dict>
            <key>assets</key>
            <array>
                <dict>
                    <key>kind</key>
                    <string>software-package</string>
                    <key>url</key>
                    <string>https://your-server.com/path/to/app.ipa</string>
                </dict>
                <dict>
                    <key>kind</key>
                    <string>display-image</string>
                    <key>url</key>
                    <string>https://your-server.com/icon-57.png</string>
                </dict>
                <dict>
                    <key>kind</key>
                    <string>full-size-image</string>
                    <key>url</key>
                    <string>https://your-server.com/icon-512.png</string>
                </dict>
            </array>
            <key>metadata</key>
            <dict>
                <key>bundle-identifier</key>
                <string>${appMetadata.bundleIdentifier}</string>
                <key>bundle-version</key>
                <string>${appMetadata.appVersion}</string>
                <key>kind</key>
                <string>software</string>
                <key>title</key>
                <string>${appMetadata.appName}</string>
                <key>subtitle</key>
                <string>${appMetadata.appName} App</string>
                <key>platform-identifier</key>
                <string>com.apple.platform.iphoneos</string>
                <key>minimum-os-version</key>
                <string>${appMetadata.minimumOS}</string>
            </dict>
        </dict>
    </array>
</dict>
</plist>`;
        }

        function displayPlistPreview(xmlContent = null) {
            if (!xmlContent) {
                xmlContent = `<!-- plist preview will appear here -->
<!-- Upload an IPA file to generate manifest -->`;
            }
            
            // Basic XML syntax highlighting
            const colorizedXML = xmlContent
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/(".*?")/g, '<span class="xml-value">$1</span>')
                .replace(/&lt;(\/)?(\w+)&gt;/g, '&lt;<span class="xml-tag">$1$2</span>&gt;')
                .replace(/&lt;key&gt;(.*?)&lt;\/key&gt;/g, '&lt;key&gt;<span class="xml-key">$1</span>&lt;/key&gt;')
                .replace(/&lt;!--(.*?)--&gt;/g, '&lt;!--<span class="xml-comment">$1</span>--&gt;');
            
            plistCode.innerHTML = colorizedXML;
        }

        function downloadPlistFile() {
            const xmlContent = buildPlistXML();
            const fileBlob = new Blob([xmlContent], { type: 'application/xml' });
            const downloadUrl = URL.createObjectURL(fileBlob);
            
            // Create download link and trigger it
            const downloadLink = document.createElement('a');
            downloadLink.href = downloadUrl;
            downloadLink.download = `${appMetadata.appName.replace(/\s/g, '_')}.plist`;
            document.body.appendChild(downloadLink);
            downloadLink.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(downloadLink);
                URL.revokeObjectURL(downloadUrl);
            }, 100);
            
            displayMessage('plist downloaded successfully', 'success');
        }

        function resetConverterState() {
            selectedFile = null;
            fileInput.value = '';
            
            // Reset metadata to defaults
            appMetadata = {
                appName: 'MyApp',
                bundleIdentifier: 'com.example.app',
                appVersion: '1.0',
                buildNumber: '1',
                minimumOS: '12.0',
                fileSize: '0 MB',
                fileName: 'app.ipa'
            };
            
            // Reset UI state
            generateBtn.disabled = true;
            downloadBtn.disabled = true;
            fileInfo.classList.remove('show');
            plistPreview.classList.remove('show');
            progressContainer.classList.remove('show');
            progressBar.style.width = '0%';
            
            // Reset displays
            refreshFileInfoDisplay();
            displayPlistPreview();
            itmsLink.textContent = 'itms-services://?action=download-manifest&url=https://yourserver.com/manifest.plist';
            
            displayMessage('Converter reset', 'info');
        }

        function calculateFileSize(byteCount) {
            if (byteCount === 0) return '0 Bytes';
            
            const unitSize = 1024;
            const sizeLabels = ['Bytes', 'KB', 'MB', 'GB'];
            const unitIndex = Math.floor(Math.log(byteCount) / Math.log(unitSize));
            const sizeValue = parseFloat((byteCount / Math.pow(unitSize, unitIndex)).toFixed(1));
            return sizeValue + ' ' + sizeLabels[unitIndex];
        }

        function displayMessage(messageText, messageType = 'info') {
            // Create popup notification
            const popup = document.createElement('div');
            popup.className = 'notification';
            
            // Set styles based on message type
            const backgroundColor = messageType === 'error' ? 'rgba(255, 68, 68, 0.9)' : 
                                   messageType === 'success' ? 'rgba(74, 222, 128, 0.9)' : 
                                   'rgba(255, 107, 53, 0.9)';
            const borderColor = messageType === 'error' ? 'rgba(255, 68, 68, 0.4)' : 
                               messageType === 'success' ? 'rgba(74, 222, 128, 0.4)' : 
                               'rgba(255, 107, 53, 0.4)';
            const shadowColor = messageType === 'error' ? 'rgba(255, 68, 68, 0.3)' : 
                               messageType === 'success' ? 'rgba(74, 222, 128, 0.3)' : 
                               'rgba(255, 107, 53, 0.3)';
            
            popup.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${backgroundColor};
                color: white;
                padding: 12px 20px;
                border-radius: 10px;
                font-size: 0.9rem;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
                backdrop-filter: blur(10px);
                border: 1px solid ${borderColor};
                box-shadow: 0 0 20px ${shadowColor};
            `;
            
            // Pick appropriate icon
            const messageIcon = messageType === 'error' ? '‚ùå' : 
                               messageType === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
            
            popup.innerHTML = `
                <span style="font-size: 1.2rem;">${messageIcon}</span>
                <span>${messageText}</span>
            `;
            
            document.body.appendChild(popup);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                popup.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (popup.parentNode) {
                        popup.parentNode.removeChild(popup);
                    }
                }, 300);
            }, 3000);
            
            // Ensure fadeOut animation exists
            if (!document.querySelector('style#notification-styles')) {
                const notificationStyles = document.createElement('style');
                notificationStyles.id = 'notification-styles';
                notificationStyles.textContent = `
                    @keyframes fadeOut {
                        from { opacity: 1; transform: translateX(0); }
                        to { opacity: 0; transform: translateX(20px); }
                    }
                `;
                document.head.appendChild(notificationStyles);
            }
        }

        // Main initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Start the weather system
            stopWeather();
            initializeWeather();
            lastHourChecked = getCurrentPDTTime().getHours();
            
            // Set up periodic updates
            setInterval(updateWindDirection, 15000); // Change wind every 15 seconds
            
            // Check for time changes every minute
            setInterval(() => {
                const currentHour = getCurrentPDTTime().getHours();
                if (currentHour !== lastHourChecked) {
                    lastHourChecked = currentHour;
                    const newWeatherType = selectWeatherType();
                    if (newWeatherType !== activeWeatherType) {
                        stopWeather();
                        initializeWeather(newWeatherType);
                    }
                }
            }, 60000);
            
            // Initialize the converter
            setupConverter();
            
            // Keep time updated
            setInterval(determineTimeOfDay, 1000);
        });
    </script>
</body>
</html>
